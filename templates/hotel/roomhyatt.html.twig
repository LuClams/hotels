{% extends 'headers/header.html.twig' %}

{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css">

{% endblock %}
{% block main %}

<main>
        <div style="max-width: 90%" class="d-flex justify-content-center">

            <div id="carouselExampleIndicators" class="carousel slide carousel-dark" data-bs-ride="true">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                 {#    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    #}</div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="{{ vich_uploader_asset(roomDetails, 'imageFile') }}"
                             alt=""
                             style="max-height: 500px;
                                    max-width: 1000px;
                                    margin: 10px">
                    </div>
                    {#  <div class="carousel-item">#}
                        {#  <img src="..." class="d-block w-100" alt="...">#}
                    {#  <img src="{{ vich_uploader_asset(roomDetails, 'imageFile') }}"
                             alt=""
                             style="max-height: 500px;
                                    max-width: 1000px;
                                    margin: 10px">
                    </div>
                    <div class="carousel-item">
                        {#  <img src="..." class="d-block w-100" alt="...">#}
                        {# <img src="{{ vich_uploader_asset(roomDetails, 'imageFile') }}"
                             alt=""
                             style="max-height: 500px;
                                    max-width: 1000px;
                                    margin: 10px">
                    </div>#}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <div class="p-3">
            <p>
                {{ roomDetails.description }}
            </p>

             <ul>
                 <li>incididunt ut :</li>
                 <li>incididunt ut labore et dolore magna aliqua.</li>
                 <li>incididunt ut labore et dolore magna aliqua.</li>
                 <li>incididunt ut labore et dolore magna aliqua.</li>
                 <li>incididunt ut labore et dolore magna aliqua.</li>

             </ul>
        </div>

        <div>
            {% for flash_error in app.flashes('verify_email_error') %}
                <div class="alert alert-danger" role="alert">{{ flash_error }}</div>
            {% endfor %}

            {% for flash_warning in app.flashes('verify_email_error') %}
                <div class="alert alert-danger" role="alert">{{ flash_warning }}</div>
            {% endfor %}

            {% for flash_success in app.flashes('verify_email_error') %}
                <div class="alert alert-success" role="alert">{{ flash_success }}</div>
            {% endfor %}

            <h3>Booking</h3>
            {{ form_start(form) }}
            <div class="alert alert-light">
                <h2>Commencez par nous dire quelles sont les dates qui vous interessent !</h2>
                <div class="row">
                    <div class="col">
                        {{ form_row(form.startDate) }}
                    </div>
                    <div class="col">
                        {{ form_row(form.endDate) }}
                    </div>
                </div>
                <h4>Montant du sejour: <span id="amount">...</span> €; </h4>
                <span id="days">0</span> nuit(s) à {{ roomDetails.price /100}} / nuit

                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                    <button type="submit" class="btn btn-primary">Valider</button>
                {% else %}
                {# <button type="submit" class="btn btn-secondary disabled">Connectez-vous pour valider la réservation</button>#}
                    <button class="btn btn-primary">
                        <a class="nav-link text-white" href="{{ path('app_login') }}" tabindex="-1" aria-disabled="true">
                            Connectez-vous pour pouvoir valider la réservation
                        </a>
                    </button>
                {% endif %}
            {{ form_end(form) }}

        </div>


{% endblock %}

{% block javascripts %}
    <script src="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.2.0/dist/js/datepicker-full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/js/bootstrap-datepicker.min.js" integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.js"></script>
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script>
        $( document ).ready(function() {
                $('#booking_form_startDate, #booking_form_endDate').datepicker({
                    format: 'dd/mm/yyyy',
                    datesDisabled: [
                        {%for day in room.notAvailableDays %}
                        "{{ day.format('d/m/Y') }}",
                        {% endfor %}
                    ],
                    startDate:new Date()
                });

                $('#booking_form_startDate, #booking_form_endDate').on('change', calculateAmount);
            });

            function calculateAmount() {
                const endDate = new Date($('#booking_form_endDate').val().replace(/(\/d+)\/(\d+)\/(\d{4})/, '$3-$2-$1'));
                // 18/09/2022
                // (\/d+)\/(\d+)\/(\d{4})
                // 2022-09-18
                const startDate = new Date($('#booking_form_startDate').val().replace(/(\/d+)\/(\d+)\/(\d{4})/, '$3-$2-$1'));

                if(startDate && endDate && startDate < endDate) {
                    const DAY_TIME = 24 * 60 * 60 * 1000;
                    const interval = endDate.getTime() - startDate.getTime();
                    const days = interval / DAY_TIME;
                    const amount = days * {{ roomDetails.price / 100 }};

                    $('#days').text(days);
                    $('#amount').text(amount.toLocaleString('fr-FR'));
                }

            }
    </script>
{% endblock %}